{% extends 'base.html' %}
{% block content %}

<script src="/static/js/map.js"></script>

<!-- SEARCH PANEL --> 

<!-- <div class="panel panel-default">
  <center><h1><div class="panel-body"> Eat Local. Eat Fresh.</div></h1></center>
</div> -->
<style>

.box-title {
    font-family: 'Open Sans';
    color: #143C22;
}

</style>

<script>
  function initMap() {

  var styledMapType = new google.maps.StyledMapType(
    [
      { 
        stylers: [
          { hue: '#00ffe6'},
          { saturation: -20 }
        ]
      }, {
        featureType: 'road',
        elementType: 'geometry',
        stylers: [
          { lightness: 100},
          { visibility: 'simplified'}
        ]
      }, {
        featureType: 'road',
        elementType: 'labels',
        stylers: [
          {visibility: 'off'}
        ]
      }
    ],
    {name: 'Styled Map'});

  var map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: -34.397, lng: 150.644},
    scrollwheel: true,
    zoom: 14,
    zoomControl: true,
    panControl: false,
    mapTypeControlOptions: {
      mapTypeIds: ['roadmap', 'satellite', 'hybrid', 'terrain',
                    'styled_map']
    }

  });


  // ASSOCIATE STYLED MAP TO MAP ID

  map.mapTypes.set('styled_map', styledMapType);
  map.setMapTypeId('styled_map');

  // SET GEOLOCATION FOR USER
  var infoWindow = new google.maps.InfoWindow({map: map});

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var pos = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };

      infoWindow.setPosition(pos);
      infoWindow.setContent('found you!');
      map.setCenter(pos);
    }, function() {
      handleLocationError(true, infoWindow, map.getCenter());
    });

    data = {
    'user_latitude': lat,
    'user_longitude': lng,
    'food_type': $('#foodType'), // map to find in HTML input forms using JQuery
    'description': $('#keySearchWords'),
    'radius': $('#distanceSelect')
    }

    $('#submitFoodRequest').click(function() {
      $.post('/JSON_food_coords', data, mapFoods(foods));

    });

  } else {

    // BROWSER DOESN'T SUPPORT GEOLOCATION
    handleLocationError(false, infoWindow, map.getCenter());
  }
}

function handleLocationError(browserHasGeolocation, infoWindow, pos) {
  infoWindow.setPosition(pos);
  infoWindow.setContent(browserHasGeolocation ?
                        'Error: The Geolocation service failed.' :
                        'Error: Your browser doesn\'t support geolocation.');
}

// pos = user location 
// can write the function outside so long as you call the function within where the var is assigned

// mapFoods is the function that takes in the backend info and uses it 

// move to helper js file 
// mapFoods will use Google Maps API to make 

// function getFoods (evt) {
//   $.post('/JSON_food_coords', data, mapFoods(foods)) // 3 params =  route, data to backend, what to do with returned data 

// }


</script>

<div class="container-fluid">
    <div class="row">
      <div id="map-container" class="fluid col-sm-8 col-md-8 pull-right">
        <div id="map" class="col-sm-8 col-md-8 pull-right"></div>
      </div>
        <div class="col-sm-4 col-md-4">
            <div class="panel-group">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <center><div class="panel-title"><i>Eat local! Eat fresh!</i></div></center>
                    <br>
                      <form action="/#" method="post">
                        <div class="form-group">
                          <label for="foodType">What can we help you find?</label>
                            <input type="text" class="form-control" id="foodType" aria-describedby="foodTypeInput" placeholder="ex: eggs; chicken; lamb">
                        </div>
                          <div class="form-group">
                            <label for="keySearchWords">Narrow Down Your Search</label>
                              <input type="text" class="form-control" id="keySearchWords" placeholder="ex: organic; free-range; all-natural">
                          </div>
                            <div class="form-group">
                              <label for="distanceSelect">Distance (in Miles)</label>
                                <select class="form-control" id="distanceSelect">
                                  <option>1</option>
                                  <option>5</option>
                                  <option>10</option>
                                  <option>20</option>
                                  <option>50+</option>
                                </select>
                            </div>
                              <div class="modal-footer">
                            <center><button type="submit" id="submitFoodRequest" class="btn btn-primary btn-block">Submit</button></center>
                          </div>
                      </form>
                  

<!-- GOOGLE MAP DISPLAY -->
<!-- <div id="map"></div>  -->

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB_Em-oYClJZRQKZDkL63wZRT0j5EaKk84&callback=initMap"
    async defer></script>

{% endblock %}
</html>